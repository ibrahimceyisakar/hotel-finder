# Data Analysis Component

This document provides detailed information about the data analysis component of the project, which is implemented in `value_analysis.py`.

## Overview

The data analysis component processes the hotel data extracted by the [web scraping component](scraping.md) to identify hotels that offer the best value for money. It calculates a "value ratio" for each hotel by dividing the review score by the price, then ranks the hotels based on this ratio.

## How It Works

1. The script reads the hotel data from the JSON file generated by the scraper.
2. For each hotel, it extracts the review score and price.
3. It calculates a value ratio (review score / price * 1000) for each hotel.
4. It sorts the hotels by value ratio in descending order.
5. It outputs the top N hotels to both JSON and CSV files.
6. It displays a summary of the top hotels in the console.

## Value Ratio Calculation

The value ratio is calculated using the following formula:

```
Value Ratio = (Review Score / Price) * 1000
```

Where:
- **Review Score**: The numerical rating of the hotel (typically on a scale of 0-10)
- **Price**: The price per night in TL (Turkish Lira)
- **1000**: A scaling factor to make the ratio more readable

This ratio represents the amount of "review score points" you get per 1000 TL spent, providing a measure of value for money.

## Price Extraction

The script handles the extraction of numerical price values from price strings that include currency symbols and formatting:

```python
def extract_numeric_value(price_str):
    """
    Extract numeric value from price string.
    Example: "17.345 TL" -> 17345
    """
    if not price_str or not isinstance(price_str, str):
        return None
    
    # Remove currency symbol and extract numbers
    matches = re.findall(r'[\d.,]+', price_str)
    if not matches:
        return None
    
    # Take the first match (should be the price)
    price_text = matches[0]
    
    # Replace thousand separator (dot in Turkish format) with empty string
    # and decimal separator (comma in Turkish format) with dot
    price_text = price_text.replace('.', '').replace(',', '.')
    
    try:
        return float(price_text)
    except ValueError:
        return None
```

This function handles Turkish price formatting, where dots are used as thousand separators and commas as decimal separators.

## Configuration Options

The main configuration options are defined at the beginning of the `main()` function:

```python
# File paths
input_json_path = 'hotels_data.json'
output_json_path = 'top_value_hotels.json'
output_csv_path = 'top_value_hotels.csv'

# Number of top hotels to output
top_n = 100
```

You can modify these variables to change:
- The input file path (`input_json_path`)
- The output file paths (`output_json_path` and `output_csv_path`)
- The number of top hotels to output (`top_n`)

## Running the Analysis

To run the analysis:

1. Ensure you have completed the [installation and setup](installation.md).
2. Make sure you have run the [web scraping component](scraping.md) to generate the input data.
3. Activate your virtual environment if you're using one.
4. Run the script:
   ```bash
   python value_analysis.py
   ```

The script will:
1. Read the hotel data from `hotels_data.json`
2. Calculate the value ratio for each hotel
3. Sort the hotels by value ratio
4. Save the top N hotels to `top_value_hotels.json` and `top_value_hotels.csv`
5. Display a summary of the top hotels in the console

## Output Files

The analysis generates two output files:

1. `top_value_hotels.json`: Contains the top N hotels by value ratio in JSON format
2. `top_value_hotels.csv`: Contains the same data in CSV format

These files will be used by the [visualization dashboard](dashboard.md) for further analysis and visualization.

## Console Output

The script also outputs a summary of the top hotels to the console, formatted as a table:

```
Top Hotels by Value Ratio:
--------------------------------------------------------------------------------
Rank  Hotel Name                               Review  Price          Value Ratio
--------------------------------------------------------------------------------
1     Hotel A                                  9.2     1500 TL        6.1333
2     Hotel B                                  8.8     1600 TL        5.5000
3     Hotel C                                  8.5     1700 TL        5.0000
...
--------------------------------------------------------------------------------
```

This provides a quick overview of the hotels with the best value for money.

## Customization

### Adjusting the Value Ratio Calculation

You can modify the value ratio calculation by changing the formula in the `calculate_value_ratio()` function:

```python
# Calculate ratio (review score per 1000 TL)
ratio = (review_score / price_value) * 1000
```

For example, you could:
- Change the scaling factor (1000) to a different value
- Add additional factors to the calculation, such as star rating
- Apply different weights to different components

### Filtering Hotels

You can add additional filtering criteria by modifying the `analyze_hotel_value()` function. For example, you could filter hotels by:
- Minimum review score
- Maximum price
- Specific features
- Location

## Troubleshooting

### Common Issues

1. **Input file not found**: Ensure that you have run the web scraping component and that the `hotels_data.json` file exists.

2. **Invalid JSON**: If the input file is corrupted or not valid JSON, the script will display an error message. Try running the web scraping component again to generate a new input file.

3. **No hotels with valid ratios**: If none of the hotels have both a valid review score and price, the script will not be able to calculate value ratios. Check the input data to ensure it contains valid review scores and prices.
